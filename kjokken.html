<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <title>Kjøkkenskjerm - Live</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-slate-950 text-white p-8">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const SUPABASE_URL = 'https://kirklktgeuqvkxhfibth.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_btB05RbKic_mG3lPpQ7jpw_NOkma2bE'; 
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        function Kitchen() {
            const [orders, setOrders] = useState([]);
            const [error, setError] = useState(null);

            const loadData = async () => {
                const { data, error } = await supabaseClient.from('orders').select('*');
                if (error) setError(error.message);
                else setOrders(data);
            };

            useEffect(() => {
                loadData();
                const sub = supabaseClient
                    .channel('changes')
                    .on('postgres_changes', { event: '*', schema: 'public', table: 'orders' }, loadData)
                    .subscribe();
                return () => supabaseClient.removeChannel(sub);
            }, []);

            return (
                <div>
                    <h1 className="text-3xl font-bold mb-6 text-emerald-400">Kjøkkenskjerm</h1>
                    
                    {error && <p className="text-red-500 mb-4">Feil: {error}</p>}
                    
                    <div className="grid gap-4">
                        {orders.length === 0 ? (
                            <p className="text-slate-500 italic">Venter på bestillinger fra databasen...</p>
                        ) : (
                            orders.map(o => (
                                <div key={o.id} className="bg-slate-900 border border-slate-800 p-6 rounded-2xl shadow-lg border-l-8 border-emerald-500">
                                    <div className="flex justify-between items-center">
                                        <div>
                                            <span className="text-emerald-400 font-black text-2xl uppercase">Bord {o.table_number}</span>
                                            <h2 className="text-xl text-slate-100 mt-1 font-medium">{o.items}</h2>
                                        </div>
                                        <div className="text-slate-700 font-mono text-sm">#{o.id}</div>
                                    </div>
                                </div>
                            ))
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Kitchen />);
    </script>
</body>
</html>
